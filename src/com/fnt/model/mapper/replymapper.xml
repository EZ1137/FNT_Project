<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="replymapper">
	<resultMap type="replydto" id="replyDtoResultMap">
		<result property="replyno" column="REPLY_NO"/>
		<result property="replyid" column="REPLY_ID"/>
		<result property="replynickname" column="REPLY_NICKNAME"/>
		<result property="replyboardno" column="REPLY_BOARDNO"/>
		<result property="replygroupno" column="REPLY_GROUPNO"/>
		<result property="replygroupseq" column="REPLY_GROUPNOSEQ"/>
		<result property="replytitletab" column="REPLY_TITLETAB"/>
		<result property="replytitle" column="REPLY_TITLE"/>
		<result property="replyregdate" column="REPLY_REGDATE"/>
	</resultMap>
<!-- 댓글 리스트 가져오기 -->
	<select id="selectreplylist" resultMap="replyDtoResultMap">
		SELECT REPLY_NO, REPLY_ID, REPLY_NICKNAME, REPLY_BOARDNO, REPLY_GROUPNO, 
				REPLY_GROUPNOSEQ, REPLY_TITLETAB, REPLY_TITLE, REPLY_REGDATE
		FROM REPLY
		ORDER BY REPLY_GROUPNO DESC, REPLY_GROUPNOSEQ
	</select>

<!-- 댓글 등록 -->
	<insert id="insertreply" parameterType="map">
		INSERT INTO REPLY
		VALUES (REPLY_SEQ.NEXTVAL,
			#{replyid},
			#{replynickname},
			#{replyboardno},
			(SELECT REPLY_GROUPNO FROM REPLY WHERE REPLY_BOARDNO = #{replyboardno}),
			(SELECT REPLY_GROUPNOSEQ FROM REPLY WHERE REPLY_BOARDNO = #{replyboardno})+1,
			(SELECT REPLY_TITLETAB FROM REPLY WHERE REPLY_BOARDNO = #{replyboardno})+1,
			#{replytitle},
			SYSDATE
		)
	</insert>
<!-- 댓글 업데이트 -->
	<update id="updatereply" parameterType="int">
		UPDATE REPLY
		SET REPLY_GROUPNOSEQ = REPLY_GROUPSEQ +1
		WHERE REPLY_GROUPNO = (SELECT REPLY_GROUPNO FROM REPLY WHERE REPLY_BOARDNO = #{replyboardno})
		AND REPLY_GROUPNOSEQ > (SELECT REPLY_GROUPNOSEQ FROMR REPLY WHERE REPLY_BOARDNO = #{replyboardno})
	</update>
	
<!-- 댓글 삭제 -->
	<delete id="deletereply" parameterType="int">
		DELETE REPLY FROM REPLY_NO = ${replyno}
	</delete>
</mapper>
